<!DOCTYPE html> 
<html lang="en">
<head><meta charset="utf-8">
<title>GTK3 - Create Lists</title>
<link rel="stylesheet" href="../html_technical/style.css" type="text/css">
<script type="text/javascript" src="../html_technical/scripts.js" ></script>

</head>
<body>
  <div class="homeLink"><a href="../index.html">↑ home</a></div>

  

<div class="tocDiv">  
    <div class="tocTitle">Contents</div>
    <div id="toc">
      <!-- generated by javascript -->
    </div>
</div>

<div class="contents">
<!-- ================================================================================ -->
<!-- ================================================================================ -->
<!-- ================================================================================ -->
<!-- ================================================================================ -->

<div>
  <a id="simpleDraw"></a><h2>Basic knowledge</h2>
  <div class="explanation">
    <div style="font-size:110%;font-weight: bold;">Info:</div>
    With GTK lists are realized by using <code>GtkTreeView</code>.<br>
    Further details to this topic can be found <a href="http://scentric.net/tutorial">here</a>.
    <br>
    <br>
    This chapter will introduce basic information on <code>GtkTreeView</code> stuff
  </div>

  <h3>MVC-Pattern</h3>
  GtkTreeView devides data (Model) from rendering (View).
  <ul>
    <li>Model: GtkTreeModel</li>
    <li>View: GtkTreeView</li>
  </ul>
  The structure of both is described below.

  <h3>GtkTreeView - Structure</h3>
  <div>
  This image shows the basic structure of the GtkTreeView.<br>
  <img src="./img/GtkTreeView_View_Layout.png" style="max-width:700px;width:100%;height:auto;"><br>
  <ul>
    <li>A <code>GtkTreeView</code> must at least have one <code>GtkCellRenderer</code>
       (If you don't have one, your column names are displayed, but you will not see 
        any content.)
   but I can also have more.</li>
   <li><code>GtkCellRenderer</code> describes a family of classes (cf. below). 
    <div><img src="img/GtkCellRenderer_Hierarchy.png" style="width:300px;height:auto;"></div></li>
      
  </ul>
  <h4>GtkTreeView - Structure - Real life example</h4>
  <img src="img/GtkTreeView_View_Layout_example_annotated.png" style="width:550px;height:auto;">
  
  </div>

  

  <h3>GtkTreeModel</h3>
  <ul>
    <li><code>GtkTreeModel</code> is an interface to a concrete data store</li>
    <li>So, <code>GtkTreeModel</code> provides a set of fucntions, that GtkTreeView could
        call.<br>
        E.g.
        <ul>
          <li>"How many rows are there?"</li>
          <li>"Which rows have children?</li>
          <li>"Give me some data."</li>
        </ul>  
    </li>
  </ul>
  <div>
    The image below depicts that relationship.<br>
    <img src="img/GtkTreeModel_GtkTreeView_connection.png"><br>
    <div class="note_uml" style="max-width: 170px;top:-40px;position:relative;">
  Data changing must be done on the concrete store
    </div>

    <span style="width:30px">&amp;nbsp;</span>

    <div class="note_uml" style="max-width: 350px;top:-5px;position:relative;">
      Interface between Store and View.<br>
      This interface ..
      <ul>
        <li>.. can only read data.</li>
        <li>.. can<b>not</b> add/remove/change data.</li>
      </ul>
      
    </div>
  </div>
</div>

<!-- ================================================================================ -->
<!-- ================================================================================ -->
<!-- ================================================================================ -->
<!-- ================================================================================ -->


<div>
  <a id="simple_table"></a><h2>A simple table</h2>
  <div class="explanation">This is what we're going to create:<br>
    <img src="img/codeResult_simpleTable.png">
  </div>
 
  <div class="codehead">table_simple.c</div>
  <pre class="codeblock">
    <span class="codeunimportant">
      <span class="codecomment">#include &amp;lt;gtk/gtk.h&amp;gt;</span> 
      
      <span class="codecomment">#include &amp;lt;stdio.h&amp;gt;</span> 
      <span class="codecomment">#include &amp;lt;iostream&amp;gt;</span> 
      
      <span class="codecomment">// ------------------------------------------------------------</span>
      
      enum EListCols{
        <span class="codeconst">LIST_COL_NAME</span> = 0,
        <span class="codeconst">LIST_COL_AGE</span>,
        <span class="codeconst">LIST_MAX_COLS</span>
      };
      
      <span class="codecomment">// ------------------------------------------------------------</span>
      </span>
      <span class="codecomment">/**
       * @brief: This function will create a new data model ('data store').
       * @return: Newly created model (GtkListStore*)
       */</span>
      GtkListStore * 
      createListModel (void)
      {
        GtkListStore *listStore;
        listStore = <span class="codefunc">gtk_list_store_new</span>(<span class="codeconst">2</span>, <span class="codeconst">G_TYPE_STRING</span>, <span class="codeconst">G_TYPE_UINT</span>);
       
        GtkTreeIter rowIter;
      
        <span class="codecomment">// Info: the below could be done in a loop with an array, but
        //      this way is easier to grasp.</span>
      
        <span class="codecomment">// Create data row 1 ( like a database entry )</span>
        <span class="codefunc">gtk_list_store_append</span>(listStore, &amp;rowIter);
        <span class="codefunc">gtk_list_store_set</span>(listStore, &amp;rowIter,
                          <span class="codeconst">LIST_COL_NAME</span>, <span class="codeconst">"AAAA"</span>, 
                          <span class="codeconst">LIST_COL_AGE</span>, <span class="codeconst">100</span>, <span class="codeconst">-</span>1);
      
        <span class="codecomment">// Create data row 2 ( like a database entry )</span>
        <span class="codefunc">gtk_list_store_append</span>(listStore, &amp;rowIter);
        <span class="codefunc">gtk_list_store_set</span>(listStore, &amp;rowIter,
                          <span class="codeconst">LIST_COL_NAME</span>, <span class="codeconst">"CCCC"</span>, 
                          <span class="codeconst">LIST_COL_AGE</span>, <span class="codeconst">60</span>, <span class="codeconst">-</span>1);
      
        <span class="codecomment">// Create data row 3 ( like a database entry )</span>
        <span class="codefunc">gtk_list_store_append</span>(listStore, &amp;rowIter);
        <span class="codefunc">gtk_list_store_set</span>(listStore, &amp;rowIter,
                          <span class="codeconst">LIST_COL_NAME</span>, <span class="codeconst">"BBBB"</span>, 
                          <span class="codeconst">LIST_COL_AGE</span>, <span class="codeconst">80</span>, <span class="codeconst">-</span>1);  
        
        return listStore;
      }

      <span class="codecomment">// ------------------------------------------------------------</span>

      <span class="codecomment">/**
       * @brief: Populate the `window` with gtk elements
       */</span>
      void 
      <span class="codefunc">setupWindow</span> (GtkWindow *window){
      
        <span class="codecomment">// ======== create a layout to place the gui elements in ==========</span>
        GtkBox* layout;
        {
          layout = (GtkBox*)<span class="codefunc">gtk_box_new</span>(<span class="codeconst">GTK_ORIENTATION_VERTICAL</span>,<span class="codeconst">10</span>);
          <span class="codefunc">gtk_container_add</span>((GtkContainer*)window, (GtkWidget*)layout);
        }
        
        <span class="codecomment">// ========= create model for the lists =============</span>
        GtkTreeModel * model;        
        model = (GtkTreeModel*)<span class="codefunc">createListModel</span>();        
 
        <span class="codecomment">// ============== create treeView ===================</span>
        {  
          GtkTreeView * treeview = (GtkTreeView *) <span class="codefunc">gtk_tree_view_new</span>();
          <span class="codefunc">gtk_box_pack_start</span>(layout, (GtkWidget*)treeview,<span class="codeconst">TRUE</span>,<span class="codeconst">TRUE</span>,<span class="codeconst">0</span>);
      
          GtkCellRenderer * renderer = (GtkCellRenderer *)<span class="codefunc">gtk_cell_renderer_text_new</span>();  
          <span class="codecomment">// setup col 1    </span>
          <span class="codefunc">gtk_tree_view_insert_column_with_attributes</span>(treeview, <span class="codeconst">-1</span>, <span class="codeconst">"Name"</span>,
                                    renderer, <span class="codeconst">"text"</span>, <span class="codeconst">LIST_COL_NAME</span>, <span class="codeconst">NULL</span>);
          <span class="codecomment">// setup col 2</span>
          <span class="codefunc">gtk_tree_view_insert_column_with_attributes</span>(treeview, <span class="codeconst">-1</span>, <span class="codeconst">"Age"</span>, 
                                    renderer, <span class="codeconst">"text"</span>, <span class="codeconst">LIST_COL_AGE</span>,  <span class="codeconst">NULL</span>);    
          
      
          <span class="codecomment">// connect model and view</span>
          <span class="codefunc">gtk_tree_view_set_model</span>(treeview,model);   
      
        }   
       
      }
      <span class="codeunimportant">
      <span class="codecomment">// ------------------------------------------------------------</span>
      
      /**
       * @brief: This function does the basic calls to setup a window.
      */
      int 
      main (int argc, char *argv[]) {
        <span class="codefunc">gtk_init</span>(&amp;argc, &amp;argv);
      
        GtkWindow *window;
        {   
          window = (GtkWindow*)<span class="codefunc">gtk_window_new</span>(<span class="codeconst">GTK_WINDOW_TOPLEVEL</span>);
          <span class="codefunc">gtk_window_set_default_size</span> (window, <span class="codeconst">200</span>, <span class="codeconst">200</span>);
          <span class="codefunc">gtk_window_set_position</span>     (window, <span class="codeconst">GTK_WIN_POS_CENTER</span>);
      
          <span class="codefunc">g_signal_connect</span>(window, "destroy", gtk_main_quit, <span class="codeconst">NULL</span>);
        }
      
        <span class="codefunc">setupWindow</span>(window);  
        
        <span class="codefunc">gtk_widget_show_all</span> ((GtkWidget*)window);
        <span class="codefunc">gtk_main</span>();
      
        return 0;
      }
      </span>
      
      <span class="codecomment">// ------------------------------------------------------------</span>
      

  </pre>
</div>

<!-- ================================================================================ -->
<!-- ================================================================================ -->
<!-- ================================================================================ -->
<!-- ================================================================================ -->

<div>
  <a id="editing_table"></a><h2>Editing a table</h2>
  <div class="explanation">
    <img src="img/codeResult_editableTable.png">
  </div>
 
  <div class="codehead">table_editable.c</div>
  <pre class="codeblock">
  <span class="codeunimportant">
  <span class="codeunimportant">
      <span class="codecomment">#include &amp;lt;gtk/gtk.h&amp;gt;</span> 
      
      <span class="codecomment">#include &amp;lt;stdio.h&amp;gt;</span> 
      <span class="codecomment">#include &amp;lt;iostream&amp;gt;</span> 
      
      <span class="codecomment">// ------------------------------------------------------------</span>
      
      enum EListCols{
        <span class="codeconst">LIST_COL_NAME</span> = 0,
        <span class="codeconst">LIST_COL_AGE</span>,
        <span class="codeconst">LIST_MAX_COLS</span>
      };
  </span>
  </span>  
      <span class="codecomment">// ------------------------------------------------------------
      /**
      * @Structure of onEdited-Calls:
      * 
      *   onEdited_age()   onEditedName()
      *          |            |
      *          ↓            ↓
      *        onEdited(...,column)
      */</span>

      <span class="codecomment">// We need to `define` the function in order to have a dynamic type</span>
      <span class="codecomment">//  for parameter `new_value`. (Hey, *you* choose to use C.)</span>
      #define                                                             \
      onEdited(liststore, str_row, int_column, new_value)                 \
      {                                                                   \
        <span class="codecomment">/* we need to use GtkListStore, because GtkTreeModel does not */</span>  \
        <span class="codecomment">/*  provide an interface for cell changing. */</span>                    \
        GtkListStore * model = <span class="codefunc">GTK_LIST_STORE</span>(liststore);                 \
                                                                          \
        <span class="codecomment">/* changes can only be made via iterators */</span>                      \
        GtkTreeIter record;                                               \
                                                                          \
        <span class="codecomment">/* retrieve the iterator for the cell, that should be changed */</span>  \
        <span class="codefunc">gtk_tree_model_get_iter_from_string</span>((GtkTreeModel*)model,         \
                                            &amp;record,str_row);             \
                                                                          \
        <span class="codefunc">gtk_list_store_set</span>(model,&amp;record, int_column,new_value,-1);       \
      } 

      <span class="codecomment">// ------------------------------------------------------------</span>

      void 
      onEdited_age (GtkCellRendererText * cell,
                    gchar * row,
                    gchar * new_value,
                    gpointer liststore)
      {      
        <span class="codefunc">onEdited</span>(liststore,row,<span class="codeconst">LIST_COL_AGE</span>,<span class="codefunc">atoi</span>(new_value));
      }

      <span class="codecomment">// ------------------------------------------------------------</span>

      void 
      onEdited_name ( GtkCellRendererText * cell,
                      gchar * row,
                      gchar * new_value,
                      gpointer liststore)
      {
        <span class="codefunc">onEdited</span>(liststore,row,<span class="codeconst">LIST_COL_NAME</span>,new_value);
      }

      <span class="codecomment">// ------------------------------------------------------------</span>

  <span class="codeunimportant">          
      <span class="codecomment">/**
       * @brief: This function will create a new data model ('data store').
       * @return: Newly created model (GtkListStore*)
       */</span>
      GtkListStore * 
      createListModel (void)
      {
        GtkListStore *listStore;
        listStore = <span class="codefunc">gtk_list_store_new</span>(<span class="codeconst">2</span>, <span class="codeconst">G_TYPE_STRING</span>, <span class="codeconst">G_TYPE_UINT</span>);
       
        GtkTreeIter rowIter;
      
        <span class="codecomment">// Info: the below could be done in a loop with an array, but
        //      this way is easier to grasp.</span>
      
        <span class="codecomment">// Create data row 1 ( like a database entry )</span>
        <span class="codefunc">gtk_list_store_append</span>(listStore, &amp;rowIter);
        <span class="codefunc">gtk_list_store_set</span>(listStore, &amp;rowIter,
                          <span class="codeconst">LIST_COL_NAME</span>, <span class="codeconst">"AAAA"</span>, 
                          <span class="codeconst">LIST_COL_AGE</span>, <span class="codeconst">100</span>, <span class="codeconst">-</span>1);
      
        <span class="codecomment">// Create data row 2 ( like a database entry )</span>
        <span class="codefunc">gtk_list_store_append</span>(listStore, &amp;rowIter);
        <span class="codefunc">gtk_list_store_set</span>(listStore, &amp;rowIter,
                          <span class="codeconst">LIST_COL_NAME</span>, <span class="codeconst">"CCCC"</span>, 
                          <span class="codeconst">LIST_COL_AGE</span>, <span class="codeconst">60</span>, <span class="codeconst">-</span>1);
      
        <span class="codecomment">// Create data row 3 ( like a database entry )</span>
        <span class="codefunc">gtk_list_store_append</span>(listStore, &amp;rowIter);
        <span class="codefunc">gtk_list_store_set</span>(listStore, &amp;rowIter,
                          <span class="codeconst">LIST_COL_NAME</span>, <span class="codeconst">"BBBB"</span>, 
                          <span class="codeconst">LIST_COL_AGE</span>, <span class="codeconst">80</span>, <span class="codeconst">-</span>1);  
        
        return listStore;
      }

      <span class="codecomment">// ------------------------------------------------------------</span>

      <span class="codecomment">/**
       * @brief: Populate the `window` with gtk elements
       */</span>
      void 
      <span class="codefunc">setupWindow</span> (GtkWindow *window)
      {      
        <span class="codecomment">// ======== create a layout to place the gui elements in ==========</span>
        GtkBox* layout;
        {
          layout = (GtkBox*)<span class="codefunc">gtk_box_new</span>(<span class="codeconst">GTK_ORIENTATION_VERTICAL</span>,<span class="codeconst">10</span>);
          <span class="codefunc">gtk_container_add</span>((GtkContainer*)window, (GtkWidget*)layout);
        }
        
        <span class="codecomment">// ========= create model for the lists =============</span>
        GtkTreeModel * model;        
        model = (GtkTreeModel*)<span class="codefunc">createListModel</span>();        
 
        <span class="codecomment">// ============== create first treeView ===================</span>
        {  
          GtkTreeView * treeview = (GtkTreeView *) <span class="codefunc">gtk_tree_view_new</span>();
          <span class="codefunc">gtk_box_pack_start</span>(layout, (GtkWidget*)treeview,<span class="codeconst">TRUE</span>,<span class="codeconst">TRUE</span>,<span class="codeconst">0</span>);
</span>        
          <span class="codecomment">// We now need one renderer per (editable) column, because that's 
          //  the only way to differentiate the columns</span>

          <span class="codecomment">// setup col 1 - name</span>
          {
            GtkCellRenderer * renderer = (GtkCellRenderer *)<span class="codefunc">gtk_cell_renderer_text_new</span>();              
            <span class="codefunc">gtk_tree_view_insert_column_with_attributes</span>(treeview, <span class="codeconst">-1</span>, <span class="codeconst">"Name"</span>,
                                      renderer, <span class="codeconst">"text"</span>, <span class="codeconst">LIST_COL_NAME</span>, <span class="codeconst">NULL</span>);
          
            <span class="codecomment">// make content editable:</span>
            <span class="codefunc">g_object_set</span>(renderer, <span class="codeconst">"editable"</span>, <span class="codeconst">TRUE</span>, <span class="codeconst">NULL</span>);    
            <span class="codefunc">g_signal_connect</span>(renderer,"edited",
                            <span class="codefunc">G_CALLBACK</span>(onEdited_name), model);           
          }
          <span class="codecomment">// setup col 2 - age</span>          
          {
            GtkCellRenderer * renderer = (GtkCellRenderer *)<span class="codefunc">gtk_cell_renderer_text_new</span>();  
            <span class="codefunc">gtk_tree_view_insert_column_with_attributes</span>(treeview, <span class="codeconst">-1</span>, <span class="codeconst">"Age"</span>, 
                                    renderer, <span class="codeconst">"text"</span>, <span class="codeconst">LIST_COL_AGE</span>,  <span class="codeconst">NULL</span>);    

            <span class="codecomment">// make content editable:</span>
            <span class="codefunc">g_object_set</span>(renderer, <span class="codeconst">"editable"</span>, <span class="codeconst">TRUE</span>, <span class="codeconst">NULL</span>);    
            <span class="codefunc">g_signal_connect</span>(renderer,"edited",
                            <span class="codefunc">G_CALLBACK</span>(onEdited_age), model);           
          }
<span class="codeunimportant">          
          <span class="codecomment">// connect model and view</span>
          <span class="codefunc">gtk_tree_view_set_model</span>(treeview,model);        
        }          
      }
      
      <span class="codecomment">// ------------------------------------------------------------</span>
<span class="codeunimportant">         
      /**
       * @brief: This function does the basic calls to setup a window.
      */
      int 
      main (int argc, char *argv[]) {
        <span class="codefunc">gtk_init</span>(&amp;argc, &amp;argv);
      
        GtkWindow *window;
        {   
          window = (GtkWindow*)<span class="codefunc">gtk_window_new</span>(<span class="codeconst">GTK_WINDOW_TOPLEVEL</span>);
          <span class="codefunc">gtk_window_set_default_size</span> (window, <span class="codeconst">200</span>, <span class="codeconst">200</span>);
          <span class="codefunc">gtk_window_set_position</span>     (window, <span class="codeconst">GTK_WIN_POS_CENTER</span>);
      
          <span class="codefunc">g_signal_connect</span>(window, "destroy", gtk_main_quit, <span class="codeconst">NULL</span>);
        }
      
        <span class="codefunc">setupWindow</span>(window);  
        
        <span class="codefunc">gtk_widget_show_all</span> ((GtkWidget*)window);
        <span class="codefunc">gtk_main</span>();
      
        return 0;
      }
      
      <span class="codecomment">// ------------------------------------------------------------</span>
</span></span>

  </pre>
</div>

<!-- ================================================================================ -->
<!-- ================================================================================ -->
<!-- ================================================================================ -->
<!-- ================================================================================ -->

<h2>Sorting in a GtkTreeView</h2>

<div class="explanation">
  This part will show you how to statically sort a List by a specific column.<br>
  As code base you should use `simple table`. Editing on sorted lists is
  more difficult and will be done later.
</div>
<p>
  For static sorting You only need to insert a `sorted` 
  model between the original model and the view.  
</p>
<p>
  Previously we had this structure:
  <div class="groupingFrame">  
    <pre class="codeblock">
    <span class="codecomment">// create model and view:</span>
    GtkTreeModel * model = createModel();
    GtkTreeView  * view  = gtk_tree_view_new();

    <span class="codecomment">// glue together:</span>
    gtk_tree_view_set_model(view, model);
    </pre>
    <img src="./img/structure_simple.png" >
  </div>
</p>


<p>
  The new structure looks effectively like this:
  <div class="groupingFrame">
  
    <pre class="codeblock">
    <span class="codecomment">// create model and view:</span>
    GtkTreeModel * model       = createModel();
    GtkTreeModel * sortedModel = ...(sortedModel,model);
    GtkTreeView  * view        = gtk_tree_view_new();

    <span class="codecomment">// glue sortedModel and view:</span>
    gtk_tree_view_set_model(view, sortedModel);
    </pre>
  
    <img src="./img/structure_sorted.png" >
  
  </div>
</p>

Here is the code (this time only for the function <code>setupWindow</code>:
<div class="codehead">void setupWindow()</div>
<pre class="codeblock">
<span class="codeunimportant">
  /**
  * @brief: Populate the `window` with gtk elements
  */
  void 
  setupWindow (GtkWindow *window){

    // ======== create a layout to place the gui elements in ==========
    GtkBox* layout;
    {
      layout = (GtkBox*)gtk_box_new(GTK_ORIENTATION_VERTICAL,10);
      gtk_container_add((GtkContainer*)window, (GtkWidget*)layout);
    }
    
    // ========= create model for the list =============
    GtkTreeModel * model;
    model = (GtkTreeModel*)createListModel();   
</span>
    <span class="codecomment">// ========= create sortmodel from model =============</span>
    GtkTreeModel * sortmodel;
    {
      sortmodel = <span class="codefunc">gtk_tree_model_sort_new_with_model</span>(model);
      <span class="codefunc">gtk_tree_sortable_set_sort_column_id</span>(<span class="codefunc">GTK_TREE_SORTABLE</span>(sortmodel),
                                            <span class="codeconst">LIST_COL_NAME</span>, <span class="codeconst">GTK_SORT_ASCENDING</span>);
    }
<span class="codeunimportant">
    // ============== create treeView ===================
    {  
      GtkTreeView * treeview = (GtkTreeView *) gtk_tree_view_new();
      gtk_box_pack_start(layout, (GtkWidget*)treeview,TRUE,TRUE,0);

      GtkCellRenderer * renderer = (GtkCellRenderer *)gtk_cell_renderer_text_new();  
      // setup col 1    
      gtk_tree_view_insert_column_with_attributes(treeview, -1, "Name",
                              renderer, "text", LIST_COL_NAME, NULL);
      // setup col 2
      gtk_tree_view_insert_column_with_attributes(treeview, -1, "Age", 
                              renderer, "text", LIST_COL_AGE,  NULL);    
      
    </span>
      <span class="codecomment">// connect model and <b>sorted model</b></span>  
      <span class="codefunc">gtk_tree_view_set_model</span>(treeview,<b style="color:red;">sortmodel</b>);   
    <span class="codeunimportant">
    }   
 
}
</span>
</pre>




<!-- ================================================================================ -->
<!-- ================================================================================ -->
<!-- ================================================================================ -->
<!-- ================================================================================ -->

<br><br><br><br><br>
<img src="./img/GtkTreeModel_hierarchy.png" style="width:200px;height:auto;">
</div> <!-- content -->

</body>
</html>